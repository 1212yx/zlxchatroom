{% extends "base.html" %}

{% block title %}聊天室 - ZLX Chatroom{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1>聊天大厅</h1>
        <p>欢迎来到多人实时聊天模块。</p>
        <div id="chat-box" class="border p-3 mb-3" style="height: 400px; overflow-y: scroll; background-color: #f8f9fa;">
            <!-- 聊天记录将显示在这里 -->
            <p class="text-muted text-center">系统消息: 连接中...</p>
        </div>
        <div class="input-group mb-3">
            <input type="text" id="message-input" class="form-control" placeholder="输入消息...">
            <button class="btn btn-primary" type="button" id="send-btn">发送</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    var socket = io();
    socket.on('connect', function() {
        var chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += '<p class="text-success">系统消息: 已连接到服务器</p>';
    });

    socket.on('message', function(data) {
        var chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += '<p>' + data + '</p>';
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    document.getElementById('send-btn').onclick = function() {
        var input = document.getElementById('message-input');
        var message = input.value;
        if (message) {
            socket.send(message);
            input.value = '';
        }
    };
    
    document.getElementById('message-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            document.getElementById("send-btn").click();
        }
    });
</script>
{% endblock %}
