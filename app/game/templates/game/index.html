<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智联星队贪吃蛇</title>
    <link rel="icon" href="{{ url_for('game.static', filename='images/watermelon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('game.static', filename='css/style.css', v='2.2') }}">
    <script src="{{ url_for('game.static', filename='js/background.js', v='2.2') }}"></script>
    <style>
        /* 内联 SVG 图标样式 */
        .icon-svg {
            width: 1em;
            height: 1em;
            vertical-align: -0.125em;
            fill: currentColor;
        }
        .icon-wrapper .icon-svg {
            width: 3rem;
            height: 3rem;
        }
        .logo .icon-svg {
            width: 3rem;
            height: 3rem;
            fill: #00e676;
        }
        .stat-icon .icon-svg {
            width: 1.5rem;
            height: 1.5rem;
            fill: white;
        }
        
        /* 霓虹灯管容器 */
        .neon-container {
            position: relative;
            width: 95vw;
            height: 90vh;
            max-width: 1600px;
            /* 居中定位 */
            margin: auto;
            
            z-index: 10;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2); /* 增加一点背景深度 */
            backdrop-filter: blur(5px); /* 毛玻璃效果 */
            border: 1px solid rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
        }
        
        /* 霓虹灯管样式 */
        .neon-tube {
            position: absolute;
            width: 4px; /* 稍微加粗 */
            height: 4px;
            background: #00ffff;
            box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
            animation: neonPulse 3s infinite alternate;
            border-radius: 2px;
        }
        
        .neon-tube-top-left {
            top: 0;
            left: 0;
            width: 100px; /* 长条形 */
            height: 4px;
        }
        .neon-tube-top-left::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100px;
            background: inherit;
            box-shadow: inherit;
            border-radius: inherit;
        }
        
        .neon-tube-top-right {
            top: 0;
            right: 0;
            width: 100px;
            height: 4px;
        }
        .neon-tube-top-right::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100px;
            background: inherit;
            box-shadow: inherit;
            border-radius: inherit;
        }
        
        .neon-tube-bottom-left {
            bottom: 0;
            left: 0;
            width: 100px;
            height: 4px;
        }
        .neon-tube-bottom-left::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 4px;
            height: 100px;
            background: inherit;
            box-shadow: inherit;
            border-radius: inherit;
        }
        
        .neon-tube-bottom-right {
            bottom: 0;
            right: 0;
            width: 100px;
            height: 4px;
        }
        .neon-tube-bottom-right::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 4px;
            height: 100px;
            background: inherit;
            box-shadow: inherit;
            border-radius: inherit;
        }
        
        @keyframes neonPulse {
            from { opacity: 0.6; box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; }
            to { opacity: 1; box-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff, 0 0 45px #00ffff; }
        }
        
        /* 确保UI层在霓虹灯管之上 */
        .app-container {
            position: relative;
            z-index: 20;
            width: 100%;
            height: 100%;
            max-width: none !important; /* 覆盖style.css */
            min-height: 0 !important; /* 覆盖style.css */
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        /* 背景层样式 */
        .cyberpunk-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- 霓虹灯管容器 - 包裹整个游戏界面 -->
    <div class="neon-container">
        <!-- 左上角霓虹灯管 -->
        <div class="neon-tube neon-tube-top-left"></div>
        <!-- 右上角霓虹灯管 -->
        <div class="neon-tube neon-tube-top-right"></div>
        <!-- 左下角霓虹灯管 -->
        <div class="neon-tube neon-tube-bottom-left"></div>
        <!-- 右下角霓虹灯管 -->
        <div class="neon-tube neon-tube-bottom-right"></div>
        
        <!-- 游戏界面内容 -->
        <div class="app-container">
        <!-- 菜单界面 -->
        <div id="menu-screen" class="screen active">
            <button id="settings-btn" class="settings-btn" title="游戏设置">
                <svg class="icon-svg" viewBox="0 0 512 512"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg>
            </button>
            <header class="menu-header">
                <div class="logo">
                    <!-- Brand Image -->
                    <img src="{{ url_for('game.static', filename='images/true.jpg') }}" alt="Logo" class="icon-svg" style="width: 3rem; height: 3rem; border-radius: 50%; object-fit: cover;">
                    <h1>智联星队贪吃蛇</h1>
                </div>
                <p class="subtitle">选择你喜欢的游戏模式开始游戏</p>
                
                <!-- Global Difficulty Selector -->
                <div class="menu-difficulty-selector">
                    <span class="selector-label">特色玩法:</span>
                    <div class="difficulty-selector">
                        <button class="diff-btn active" data-diff="no_boundary">无边界</button>
                        <button class="diff-btn" data-diff="obstacles">障碍</button>
                        <button class="diff-btn" data-diff="time_limit">限时</button>
                    </div>
                </div>

                <!-- Skin Selector -->
                <div class="menu-difficulty-selector" style="margin-top: 0.5rem;">
                    <div style="display: grid; grid-template-columns: auto auto; gap: 1rem; align-items: center;">
                        <span class="selector-label" style="text-align: right;">基础皮肤:</span>
                        <div class="skin-selector">
                            <div class="skin-option active" data-skin="default" style="background: #4CAF50;" title="经典绿"></div>
                            <div class="skin-option" data-skin="blue" style="background: #2196F3;" title="海洋蓝"></div>
                            <div class="skin-option" data-skin="purple" style="background: #9C27B0;" title="神秘紫"></div>
                            <div class="skin-option" data-skin="gold" style="background: #FFC107;" title="土豪金"></div>
                            <div class="skin-option" data-skin="dark" style="background: #212121;" title="暗夜黑"></div>
                        </div>

                        <span class="selector-label" style="text-align: right;">高级皮肤:</span>
                        <div class="skin-selector">
                            <div class="skin-option" data-skin="kuromi" title="宅女琪洛米"></div>
                            <div class="skin-option" data-skin="orange_soda" title="橘子汽水"></div>
                            <div class="skin-option" data-skin="flower_fairy" title="鲜花精灵"></div>
                            <div class="skin-option" data-skin="graceful_lady" title="婉约佳人"></div>
                            <div class="skin-option" data-skin="moon_goddess" title="月亮女神"></div>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="main-content-row">
                <div class="mode-cards">
                    <!-- 单人模式 -->
                    <div class="card mode-card" data-mode="single">
                    <div class="icon-wrapper single-icon">
                        <!-- User Icon -->
                        <svg class="icon-svg" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"/></svg>
                    </div>
                    <h2>单人模式</h2>
                    <p>经典贪吃蛇玩法，挑战自己的极限，获得最高分数。适合练习和放松。</p>
                    <ul class="features-list">
                        <li>经典游戏玩法</li>
                        <li>挑战最高分</li>
                        <li>无时间限制</li>
                        <li>适合新手练习</li>
                    </ul>
                    <button class="btn btn-primary start-btn" onclick="window.startGame ? startGame('single') : alert('正在加载资源，请稍候...')">开始单人游戏</button>
                </div>

                <!-- AI对战 -->
                <div class="card mode-card" data-mode="ai">
                    <div class="icon-wrapper ai-icon">
                        <!-- Robot Icon -->
                        <svg class="icon-svg" viewBox="0 0 640 512"><path d="M320 0c17.7 0 32 14.3 32 32V96H472c39.8 0 72 32.2 72 72V440c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72H288V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H208zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H304zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H400zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224H64V416H48c-26.5 0-48-21.5-48-48V272c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H576V224h16z"/></svg>
                    </div>
                    <h2>AI对战</h2>
                    <p>与智能AI对手竞争，抢夺食物资源，考验你的策略和反应能力。</p>
                    <ul class="features-list">
                        <li>智能AI对手</li>
                        <li>竞争性玩法</li>
                        <li>策略性更强</li>
                        <li>初始100分制</li>
                    </ul>
                    <button class="btn btn-purple start-btn" onclick="window.startGame ? startGame('ai') : alert('正在加载资源，请稍候...')">挑战AI对手</button>
                </div>

                <!-- 多人对战 -->
                <div class="card mode-card" data-mode="multi">
                    <div class="icon-wrapper multi-icon">
                        <!-- Users Icon -->
                        <svg class="icon-svg" viewBox="0 0 640 512"><path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2h61.4C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"/></svg>
                    </div>
                    <h2>多人对战</h2>
                    <p>与朋友或其他玩家在线对战。加入AI对手，体验最刺激的多人竞技。</p>
                    <ul class="features-list">
                        <li>最多4名玩家</li>
                        <li>2个AI对手</li>
                        <li>实时在线对战</li>
                        <li>局域网支持</li>
                    </ul>
                    <button class="btn btn-blue start-btn" onclick="window.startGame ? startGame('multi') : alert('正在加载资源，请稍候...')">进入多人大厅</button>
                </div>
            </div>

            <!-- 排行榜区域 -->
            <div class="leaderboard-section">
                <h3>
                    <!-- Ranking Icon -->
                    <svg class="icon-svg" viewBox="0 0 576 512"><path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>
                    排行榜 TOP 10
                </h3>
                <div class="leaderboard-container">
                    <table id="leaderboard-table">
                        <thead>
                            <tr>
                                <th>排名</th>
                                <th>玩家</th>
                                <th>分数</th>
                                <th>日期</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
                </div>
            </div>
        </div>

        <!-- 多人游戏大厅 -->
        <div id="lobby-screen" class="screen hidden">
            <div class="lobby-card">
                <div class="lobby-header">
                    <div class="room-id-container">
                        <h2>创建房间号:</h2>
                        <div class="room-input-group">
                            <input type="text" id="lobby-room-input" maxlength="6" placeholder="输入房间号">
                            <button id="generate-room-btn" class="btn-icon" title="随机生成">
                                <svg class="icon-svg" viewBox="0 0 512 512"><path d="M463.5 224H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5z"/></svg>
                            </button>
                            <button id="copy-room-btn" class="btn-icon" title="复制房间号">
                                <svg class="icon-svg" viewBox="0 0 448 512"><path d="M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"/></svg>
                            </button>
                        </div>
                    </div>

                    <div class="room-id-container" style="margin-left: 20px;">
                        <h2>加入房间:</h2>
                        <div class="room-input-group">
                            <input type="text" id="join-room-input" maxlength="6" placeholder="输入房间号">
                            <button id="join-room-btn" class="btn-icon" title="加入房间">
                                <svg class="icon-svg" viewBox="0 0 640 512"><path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM544 384h32v96h96v32H576v96H544V512H448V480h96V384z"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="server-status">
                        <svg class="icon-svg" viewBox="0 0 576 512" style="width: 1em; height: 1em; margin-right: 5px;"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128c-1.4 0-2.8 0-4.2-.1c-1.1 0-2.2 .1-3.3 .1H104c-22.1 0-40-17.9-40-40V363.5c-.9 2.8-2.2 5.8-2.2 8.8l.7-160.2h-32c-18 0-32-15-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>
                        <span>本地服务器</span>
                    </div>
                </div>

                <div class="lobby-content">
                    <!-- 左侧：玩家列表 -->
                    <div class="lobby-column left-col">
                        <div class="player-group">
                            <h3>玩家列表</h3>
                            <div class="player-list">
                                <div class="player-item">
                                    <div class="avatar user-avatar">
                                        <!-- Smile Icon -->
                                        <svg class="icon-svg" viewBox="0 0 496 512" style="fill: #FFD54F;"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8 .4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg>
                                    </div>
                                    <div class="player-info">
                                        <span class="player-name">小哥</span>
                                        <span class="player-role">房主</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="player-group">
                            <h3>AI对手</h3>
                            <div class="player-list ai-list">
                                <div class="player-item">
                                    <div class="avatar ai-avatar">
                                        <!-- Robot Icon -->
                                        <svg class="icon-svg" viewBox="0 0 640 512" style="fill: #90A4AE;"><path d="M320 0c17.7 0 32 14.3 32 32V96H472c39.8 0 72 32.2 72 72V440c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72H288V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H208zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H304zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H400zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224H64V416H48c-26.5 0-48-21.5-48-48V272c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H576V224h16z"/></svg>
                                    </div>
                                    <div class="player-info">
                                        <span class="player-name">AI-1</span>
                                        <span class="badge ai-badge">AI</span>
                                    </div>
                                </div>
                                <div class="player-item">
                                    <div class="avatar ai-avatar">
                                        <svg class="icon-svg" viewBox="0 0 640 512" style="fill: #90A4AE;"><path d="M320 0c17.7 0 32 14.3 32 32V96H472c39.8 0 72 32.2 72 72V440c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72H288V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H208zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H304zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H400zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224H64V416H48c-26.5 0-48-21.5-48-48V272c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H576V224h16z"/></svg>
                                    </div>
                                    <div class="player-info">
                                        <span class="player-name">AI-2</span>
                                        <span class="badge ai-badge">AI</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：设置与规则 -->
                    <div class="lobby-column right-col">
                        <div class="lobby-section">
                            <h3>
                                <svg class="icon-svg" viewBox="0 0 512 512"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg>
                                游戏设置
                            </h3>
                            <div class="setting-row">
                                <label>当前玩法</label>
                                <div class="current-mode-display" id="lobby-mode-display">
                                    <span class="mode-text">无边界</span>
                                </div>
                            </div>
                        </div>

                        <div class="lobby-section">
                            <h3>多人对战规则</h3>
                            <div class="food-legend">
                                <div class="food-item">
                                    <img src="{{ url_for('game.static', filename='images/cabbage.svg') }}" class="food-icon" alt="白菜">
                                    <div class="food-desc">
                                        <strong>白菜 (普通)</strong>
                                        <span>+1 长度, +10 基础分</span>
                                    </div>
                                </div>
                                <div class="food-item">
                                    <img src="{{ url_for('game.static', filename='images/watermelon.svg') }}" class="food-icon" alt="西瓜">
                                    <div class="food-desc">
                                        <strong>西瓜 (加分)</strong>
                                        <span>+1 长度, 分数 ×2 (+20分)</span>
                                    </div>
                                </div>
                                <div class="food-item">
                                    <img src="{{ url_for('game.static', filename='images/chili.svg') }}" class="food-icon" alt="辣椒">
                                    <div class="food-desc">
                                        <strong>辣椒 (缩短)</strong>
                                        <span>-1 长度 (长度>3生效)</span>
                                    </div>
                                </div>
                                <div class="food-item">
                                    <img src="{{ url_for('game.static', filename='images/chicken_leg.svg') }}" class="food-icon" alt="鸡腿">
                                    <div class="food-desc">
                                        <strong>鸡腿 (无敌)</strong>
                                        <span>5秒无敌 (穿墙/免疫碰撞)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lobby-footer">
                    <button class="btn btn-green start-game-btn" onclick="startMultiplayerGame()">
                        <svg class="icon-svg" viewBox="0 0 448 512" style="width: 1em; height: 1em; vertical-align: -0.125em; margin-right: 5px;"><path d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"/></svg>
                        开始游戏
                    </button>
                    <button class="btn btn-outline leave-room-btn" onclick="leaveLobby()">离开房间</button>
                </div>
            </div>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-screen" class="screen hidden">
            <div class="game-layout">
                <!-- 左侧：统计与说明 -->
                <div class="panel left-panel">
                    <div class="card stats-card">
                        <h3>游戏统计</h3>
                        <div class="stat-item">
                            <div class="stat-icon yellow">
                                <!-- Trophy Icon -->
                                <svg class="icon-svg" viewBox="0 0 576 512"><path d="M400 0H176c-26.5 0-48.1 21.8-47.1 48.2c.2 5.3 .4 10.6 .7 15.8H24C10.7 64 0 74.7 0 88c0 92.6 33.5 157 78.5 200.7c44.3 43.1 98.3 64.8 138.1 75.8c23.4 6.5 39.4 26 39.4 45.6c0 20.9-17 37.9-37.9 37.9H192c-17.7 0-32 14.3-32 32s14.3 32 32 32H384c17.7 0 32-14.3 32-32s-14.3-32-32-32H357.9C337 448 320 431 320 410.1c0-19.6 15.9-39.2 39.4-45.6c39.9-11 93.9-32.7 138.2-75.8C542.5 245 576 180.6 576 88c0-13.3-10.7-24-24-24H446.4c.3-5.2 .5-10.4 .7-15.8C448.1 21.8 426.5 0 400 0zM48.9 112h84.4c9.1 90.1 29.2 150.3 51.9 190.6c-24.9-11-50.8-26.5-73.2-48.3c-32-31.1-58-76-63-142.3zM464.1 254.3c-22.4 21.8-48.3 37.3-73.2 48.3c22.7-40.3 42.8-100.5 51.9-190.6h84.4c-5.1 66.3-31.1 111.2-63.1 142.3z"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="label">得分</span>
                                <span class="value" id="score">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon green">
                                <!-- Ruler Icon -->
                                <svg class="icon-svg" viewBox="0 0 512 512"><path d="M160 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h96c17.7 0 32 14.3 32 32V480c0 17.7-14.3 32-32 32H64c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32h96V32c0-17.7 14.3-32 32-32s32 14.3 32 32zM128 96H64V480H448V96H384V128c0 17.7-14.3 32-32 32s-32-14.3-32-32V96H192V128c0 17.7-14.3 32-32 32s-32-14.3-32-32V96zM256 224v96c0 17.7 14.3 32 32 32s32-14.3 32-32V224c0-17.7-14.3-32-32-32s-32 14.3-32 32z"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="label">长度</span>
                                <span class="value" id="length">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon blue">
                                <!-- Bolt Icon -->
                                <svg class="icon-svg" viewBox="0 0 384 512"><path d="M0 256L28.5 28c2-16 15.6-28 31.8-28H228.9c15 0 27.1 12.1 27.1 27.1c0 3.2-.6 6.5-1.7 9.5L208 160H347.3c20.2 0 36.7 16.4 36.7 36.7c0 7.4-2.2 14.6-6.4 20.7l-192.2 281c-5.9 8.6-15.6 13.7-25.9 13.7c-19.1 0-34.6-15.5-34.6-34.6c0-3.9 .8-7.8 2.3-11.5L176 320H64c-17.7 0-32-14.3-32-32c0-4.9 1.1-9.6 3.2-13.9L0 256z"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="label">最高分</span>
                                <span class="value" id="high-score">0</span>
                            </div>
                        </div>
                        <div class="stats-row">
                            <div class="mini-stat">
                                <span class="label">难度</span>
                                <span class="value" id="current-difficulty">中等</span>
                            </div>

                        </div>
                    </div>

                    <div class="card instruction-card">
                        <h3>游戏说明</h3>
                        <table class="key-table">
                            <thead>
                                <tr><th>按键</th><th>功能</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><kbd>↑</kbd> / <kbd>W</kbd></td><td>向上移动</td></tr>
                                <tr><td><kbd>↓</kbd> / <kbd>S</kbd></td><td>向下移动</td></tr>
                                <tr><td><kbd>←</kbd> / <kbd>A</kbd></td><td>向左移动</td></tr>
                                <tr><td><kbd>→</kbd> / <kbd>D</kbd></td><td>向右移动</td></tr>
                                <tr><td><kbd>Space</kbd></td><td>加速</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 中间：游戏画布 -->
                <div class="game-area">
                    <canvas id="game-canvas" width="600" height="600"></canvas>
                    <div id="game-overlay" class="hidden">
                        <div class="overlay-content">
                            <h2 id="overlay-title">游戏结束</h2>
                            <p id="overlay-message">你的得分: 100</p>
                            <button class="btn btn-primary" onclick="restartGame()">再玩一次</button>
                            <button class="btn btn-secondary" onclick="exitGame()">返回菜单</button>
                        </div>
                    </div>
                </div>

                <!-- 右侧：控制面板 -->
                <div class="panel right-panel">
                    <div class="card control-card">
                        <h3>
                            <!-- Gear Icon -->
                            <svg class="icon-svg" viewBox="0 0 512 512"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg>
                            游戏控制
                        </h3>
                        
                        <div class="control-group">
                            <label>游戏模式</label>
                            <div class="mode-display">
                                <span class="mode-tag active" id="display-mode-single">单人模式</span>
                                <span class="mode-tag" id="display-mode-ai">AI对战</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-success" id="btn-pause" onclick="togglePause()">暂停游戏</button>
                            <button class="btn btn-primary" onclick="restartGame()">重新开始</button>
                            <button class="btn btn-danger" onclick="exitGame()">退出游戏</button>
                        </div>
                    </div>

                    <div class="card control-card" style="margin-top: 20px;">
                        <h3>
                            <svg class="icon-svg" viewBox="0 0 576 512"><path d="M264.5 5.2c14.9-6.9 32.1-6.9 47 0l218.6 101c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 149.8C37.4 145.8 32 137.3 32 128s5.4-17.9 13.9-21.8L264.5 5.2zM476.9 209.6l53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 277.8C37.4 273.8 32 265.3 32 256s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0l152-70.2zm-152 198.2l152-70.2 53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 405.8C37.4 401.8 32 393.3 32 384s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0z"/></svg>
                            食物变体规则
                        </h3>
                        <div class="food-legend">
                            <div class="food-item">
                                <img src="{{ url_for('game.static', filename='images/cabbage.svg') }}" class="food-icon" alt="白菜">
                                <div class="food-desc">
                                    <strong>白菜 (普通)</strong>
                                    <span>+1 长度, +10 基础分</span>
                                </div>
                            </div>
                            <div class="food-item">
                                <img src="{{ url_for('game.static', filename='images/watermelon.svg') }}" class="food-icon" alt="西瓜">
                                <div class="food-desc">
                                    <strong>西瓜 (加分)</strong>
                                    <span>+1 长度, 分数 ×2 (+20分)</span>
                                </div>
                            </div>
                            <div class="food-item">
                                <img src="{{ url_for('game.static', filename='images/chili.svg') }}" class="food-icon" alt="辣椒">
                                <div class="food-desc">
                                    <strong>辣椒 (缩短)</strong>
                                    <span>-1 长度 (长度>3生效)</span>
                                </div>
                            </div>
                            <div class="food-item">
                                <img src="{{ url_for('game.static', filename='images/chicken_leg.svg') }}" class="food-icon" alt="鸡腿">
                                <div class="food-desc">
                                    <strong>鸡腿 (无敌)</strong>
                                    <span>5秒无敌 (穿墙/免疫碰撞)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2>游戏设置</h2>
            </div>
            <div class="settings-body">
                <div class="setting-item">
                    <span>音效</span>
                    <label class="switch">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <button class="btn btn-primary" id="close-settings-btn">关闭</button>
        </div>
    </div>
    </div>
    </div>

    <!-- 赛博朋克动态背景 -->
    <div id="cyberpunk-background" class="cyberpunk-background"></div>

    <script src="https://cdn.bootcdn.net/ajax/libs/socket.io/4.0.1/socket.io.min.js" defer></script>
    <script src="{{ url_for('game.static', filename='js/utils.js', v='2.2') }}" defer></script>
    <script src="{{ url_for('game.static', filename='js/food.js', v='2.2') }}" defer></script>
    <script src="{{ url_for('game.static', filename='js/snake.js', v='2.2') }}" defer></script>
    <script src="{{ url_for('game.static', filename='js/game.js', v='2.2') }}" defer></script>
    <script src="{{ url_for('game.static', filename='js/main.js', v='2.2') }}" defer></script>
    <script>
        // 初始化赛博朋克背景
        document.addEventListener('DOMContentLoaded', function() {
            const background = new CyberpunkBackground();
            background.init();
            
            // 全局访问
            window.cyberpunkBackground = background;
        });
    </script>
</body>
</html>